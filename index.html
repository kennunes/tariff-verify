import React, { useState, useEffect, useMemo } from 'react';
import { 
  Zap, 
  TrendingUp, 
  Battery, 
  Sun, 
  Moon,
  ArrowRight, 
  ShieldCheck, 
  BarChart3, 
  Clock, 
  FileText, 
  Upload, 
  RefreshCcw, 
  CheckCircle2, 
  Settings, 
  AlertCircle, 
  Loader2, 
  Mail, 
  User, 
  Building2, 
  Phone, 
  PieChart, 
  Calculator, 
  ArrowDownCircle, 
  Activity, 
  X, 
  Table, 
  Calendar, 
  Info, 
  Coins, 
  TrendingDown,
  Globe,
  Award,
  ZapOff,
  Lightbulb,
  HandCoins
} from 'lucide-react';

// --- Constants & Defaults ---
const CURRENCY_SYMBOL = "R";
const SYSTEM_LIFETIME = 25;
const SPECIFIC_YIELD_P90 = 1520; // kWh/kWp (Conservative estimate)
const ANNUAL_DEGRADATION = 0.007; // 0.7% linear efficiency loss
const ANNUAL_OM_PCT = 0.015; // 1.5% of CAPEX for maintenance
const ANNUAL_TARIFF_ESCALATION = 0.065; // 6.5% Compounded increase

const SEASONAL_WEIGHTS = [
  { month: "January", weight: 0.48 },    
  { month: "February", weight: 0.45 },   
  { month: "March", weight: 1.45 },      
  { month: "April", weight: 0.78 },      
  { month: "May", weight: 0.92 },        
  { month: "June", weight: 0.95 },       
  { month: "July", weight: 1.35 },       
  { month: "August", weight: 1.10 },     
  { month: "September", weight: 1.38 },    
  { month: "October", weight: 1.08 },     
  { month: "November", weight: 1.05 },    
  { month: "December", weight: 0.92 },    
];

const SPONSORS = [
  "Luminary Power Solutions",
  "Green Grid EPC",
  "South Solar Infrastructure",
  "Cape Energy Partners",
  "Zenith Photovoltaics",
  "Helios Systems Africa",
  "Apex Renewables",
  "SolarPath EPC",
  "GridGuard Energy",
  "VoltVantage Solar"
];

const App = () => {
  // --- Global State ---
  const [phase, setPhase] = useState(1);
  const [apiKey, setApiKey] = useState("");
  const [isConfigOpen, setIsConfigOpen] = useState(false);
  const [isBreakdownOpen, setIsBreakdownOpen] = useState(false);
  const [activeModal, setActiveModal] = useState(null); 
  const [isDarkMode, setIsDarkMode] = useState(true);
  
  // Safe SSR Loading for localStorage
  useEffect(() => {
    if (typeof window !== 'undefined') {
      const storedKey = localStorage.getItem('tariff_verify_key');
      if (storedKey) setApiKey(storedKey);
      
      const storedTheme = localStorage.getItem('school_solar_theme');
      if (storedTheme === 'light') setIsDarkMode(false);
    }
  }, []);

  useEffect(() => {
    if (typeof window !== 'undefined') {
      localStorage.setItem('school_solar_theme', isDarkMode ? 'dark' : 'light');
    }
  }, [isDarkMode]);

  // --- Phase 1 State ---
  const [file, setFile] = useState(null);
  const [base64Data, setBase64Data] = useState(null);
  const [mimeType, setMimeType] = useState("");
  const [isAuditing, setIsAuditing] = useState(false);
  const [error, setError] = useState(null);
  const [auditResults, setAuditResults] = useState(null);

  // --- Phase 2 State ---
  const [supplierCostA, setSupplierCostA] = useState(1150000);
  const [supplierCostB, setSupplierCostB] = useState(2100000);

  // --- Methods ---
  const handleFileUpload = (e) => {
    const uploadedFile = e.target.files[0];
    if (!uploadedFile) return;
    setFile(uploadedFile);
    const reader = new FileReader();
    reader.onload = (event) => {
      setBase64Data(event.target.result.split(',')[1]);
      setMimeType(uploadedFile.type || 'image/png');
    };
    reader.readAsDataURL(uploadedFile);
  };

  const runAudit = async () => {
    if (!base64Data || !apiKey) return;
    setIsAuditing(true);
    setError(null);
    const prompt = `Perform a high-precision utility tariff audit for a school. 
    Return ONLY JSON: { 
      "utility_type": "Electricity",
      "total_consumption": number, 
      "unit": "kWh",
      "total_amount_due": number, 
      "currency": "R", 
      "billing_month": "January" | "February" | ... | "December",
      "billing_period": "string", 
      "cost_breakdown": [
        {"category": "Energy Charges", "amount": number},
        {"category": "Fixed/Network Fees", "amount": number},
        {"category": "VAT", "amount": number},
        {"category": "Levies/Other", "amount": number}
      ] 
    }`;

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            role: "user",
            parts: [{ text: prompt }, { inlineData: { mimeType, data: base64Data } }]
          }],
          generationConfig: { responseMimeType: "application/json" }
        })
      });
      const data = await response.json();
      const results = JSON.parse(data.candidates[0].content.parts[0].text);
      setAuditResults(results);
    } catch (err) {
      setError("Audit failed. Ensure API Key is valid and document is legible.");
    } finally {
      setIsAuditing(false);
    }
  };

  const comparison = useMemo(() => {
    if (!auditResults) return null;
    
    const effectiveRate = auditResults.total_amount_due / auditResults.total_consumption;
    const billMonth = auditResults.billing_month || "October";
    const currentMonthWeight = SEASONAL_WEIGHTS.find(w => w.month === billMonth)?.weight || 1.0;
    const baseConsumptionBaseline = auditResults.total_consumption / currentMonthWeight;

    const annualProjection = SEASONAL_WEIGHTS.map(w => ({
      month: w.month,
      consumption: baseConsumptionBaseline * w.weight,
      cost: (baseConsumptionBaseline * w.weight) * effectiveRate
    }));

    const annualConsumption = annualProjection.reduce((acc, m) => acc + m.consumption, 0);
    const annualLiability = annualProjection.reduce((acc, m) => acc + m.cost, 0);

    const analyzeSystem = (cap, cost) => {
      const annualProd = cap * SPECIFIC_YIELD_P90; 
      const selfConsumption = 0.90; 
      
      const usableAnnualProd = Math.min(annualProd, annualConsumption) * selfConsumption;
      const year1Saving = usableAnnualProd * effectiveRate;
      
      let cumulativeSavings = 0;
      let cumulativeProduction = 0;
      let currentYearRate = effectiveRate;
      let currentYearProd = annualProd;
      const yearByYear = [];

      for (let i = 1; i <= 25; i++) {
        const yearUsableProd = Math.min(currentYearProd, annualConsumption) * selfConsumption;
        const yearSavings = yearUsableProd * currentYearRate;
        
        cumulativeSavings += yearSavings;
        cumulativeProduction += currentYearProd;
        
        yearByYear.push({
          year: i,
          rate: currentYearRate,
          yield: currentYearProd,
          savings: yearSavings,
          cumulative: cumulativeSavings
        });

        currentYearRate *= (1 + ANNUAL_TARIFF_ESCALATION); 
        currentYearProd *= (1 - ANNUAL_DEGRADATION); 
      }

      const lifetimeOM = cost * ANNUAL_OM_PCT * 25;
      const net25YrSaving = cumulativeSavings - cost - lifetimeOM;
      const lcoe = (cost + lifetimeOM) / cumulativeProduction;

      return {
        capacity: cap,
        cost: cost,
        lcoe,
        monthlySaving: year1Saving / 12,
        annualSaving: year1Saving,
        newBill: Math.max(0, auditResults.total_amount_due - (year1Saving / 12)),
        payback: cost / year1Saving,
        annualProd,
        coveragePct: Math.min(100, (annualProd / annualConsumption) * 100),
        twentyFiveYearNetSaving: net25YrSaving,
        totalLifetimeCosts: cost + lifetimeOM,
        totalLifetimeProduction: cumulativeProduction,
        yearByYear
      };
    };

    return {
      effectiveRate,
      annualConsumption,
      annualLiability,
      annualProjection,
      systemA: analyzeSystem(65, supplierCostA),
      systemB: analyzeSystem(130, supplierCostB)
    };
  }, [auditResults, supplierCostA, supplierCostB]);

  const ProgressHeader = () => (
    <div className="flex items-center justify-center mb-12 gap-4">
      {[1, 2, 3].map((num) => (
        <React.Fragment key={num}>
          <div className={`flex items-center gap-2 ${phase === num ? 'text-lime-500' : phase > num ? 'text-emerald-500' : isDarkMode ? 'text-slate-600' : 'text-slate-400'}`}>
            <div className={`w-8 h-8 rounded-full border-2 flex items-center justify-center font-black text-xs ${phase === num ? 'border-lime-500 bg-lime-500/10' : phase > num ? 'border-emerald-500 bg-emerald-500' : isDarkMode ? 'border-slate-800' : 'border-slate-300'}`}>
              {phase > num ? <CheckCircle2 className="w-4 h-4 text-white" /> : num}
            </div>
            <span className="text-[10px] font-black uppercase tracking-widest hidden md:block">
              {num === 1 ? 'Audit' : num === 2 ? 'Impact' : 'Tender'}
            </span>
          </div>
          {num < 3 && <div className={`h-0.5 w-12 rounded-full ${phase > num ? 'bg-emerald-500' : isDarkMode ? 'bg-slate-800' : 'bg-slate-300'}`} />}
        </React.Fragment>
      ))}
    </div>
  );

  return (
    <div className={`min-h-screen transition-colors duration-300 font-sans p-4 md:p-8 relative overflow-x-hidden ${isDarkMode ? 'bg-[#020617] text-slate-200' : 'bg-slate-50 text-slate-800'}`}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap'); 
        body { font-family: 'Inter', sans-serif; }
        @keyframes scroll {
          0% { transform: translateX(0); }
          100% { transform: translateX(calc(-250px * ${SPONSORS.length})); }
        }
        .animate-scroll {
          display: flex;
          width: calc(250px * ${SPONSORS.length * 2});
          animation: scroll 40s linear infinite;
        }
        .animate-scroll:hover {
          animation-play-state: paused;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(100, 116, 139, 0.2); border-radius: 10px; }
      `}</style>
      
      <header className="max-w-7xl mx-auto mb-10 flex justify-between items-center">
        <div className="flex items-center gap-4">
          <div className="p-2.5 bg-gradient-to-tr from-lime-500 to-emerald-600 rounded-xl shadow-lg shadow-lime-500/20">
            <Zap className="w-6 h-6 text-white fill-white/20" />
          </div>
          <div>
            <h1 className={`text-xl font-black tracking-tight leading-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Solar PV <span className="text-lime-500">for Schools</span></h1>
            <p className="text-slate-500 text-[10px] font-bold uppercase tracking-wider">Estimate Evaluator: Bridging Utility Bills & Educational Value</p>
          </div>
        </div>
        
        <div className="flex items-center gap-2">
          <button 
            onClick={() => setIsDarkMode(!isDarkMode)}
            className={`p-2.5 rounded-xl border transition-all ${isDarkMode ? 'border-slate-800 bg-slate-800/50 text-yellow-400' : 'border-slate-200 bg-white text-slate-600 shadow-sm hover:bg-slate-50'}`}
          >
            {isDarkMode ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
          </button>
          <button onClick={() => setIsConfigOpen(true)} className={`p-2.5 rounded-xl border transition-all ${apiKey ? 'border-lime-500/20 bg-lime-500/5 text-lime-500' : isDarkMode ? 'border-slate-800 bg-slate-800/50 text-slate-500' : 'border-slate-200 bg-white text-slate-500 shadow-sm'}`}>
            <Settings className="w-5 h-5" />
          </button>
        </div>
      </header>

      <main className="max-w-5xl mx-auto">
        <ProgressHeader />

        {phase === 1 && (
          <div className="space-y-6 animate-in fade-in duration-500">
            {!auditResults ? (
              <div className={`border rounded-[2rem] p-8 md:p-12 shadow-2xl transition-all ${isDarkMode ? 'bg-slate-900/40 border-white/5' : 'bg-white border-slate-200'}`}>
                <div className="text-center mb-10">
                  <h2 className={`text-2xl font-black mb-2 uppercase tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Phase 1: Municipal Audit</h2>
                  <p className="text-slate-500 text-xs font-medium">Extracting tariff components to establish a baseline for sponsorship.</p>
                </div>
                {!file ? (
                  <div className={`group relative border-2 border-dashed rounded-3xl p-16 transition-all duration-300 cursor-pointer text-center ${isDarkMode ? 'border-slate-800 hover:border-lime-500/40 bg-slate-950/50' : 'border-slate-200 hover:border-lime-500/40 bg-slate-50'}`} onClick={() => document.getElementById('file-input').click()}>
                    <input type="file" id="file-input" hidden onChange={handleFileUpload} accept="image/*,application/pdf" />
                    <Upload className="w-12 h-12 text-slate-400 group-hover:text-lime-500 mx-auto mb-4" />
                    <p className={`font-black text-lg ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Drop Municipal Bill Here</p>
                  </div>
                ) : (
                  <div className="space-y-6">
                    <div className={`flex items-center gap-4 p-4 rounded-2xl border ${isDarkMode ? 'bg-slate-950 border-white/5' : 'bg-slate-50 border-slate-200'}`}>
                      <FileText className="w-8 h-8 text-lime-500" />
                      <div className="flex-1 truncate text-sm font-bold">{file.name}</div>
                      <button onClick={() => setFile(null)} className="p-2 text-slate-500"><RefreshCcw className="w-4 h-4" /></button>
                    </div>
                    {error && <div className="p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-xs flex gap-2"><AlertCircle className="w-4 h-4"/>{error}</div>}
                    <button onClick={runAudit} disabled={isAuditing} className="w-full py-4 bg-lime-500 hover:bg-lime-600 rounded-2xl font-black text-xs uppercase tracking-widest text-white shadow-xl shadow-lime-500/20 flex items-center justify-center gap-3">
                      {isAuditing ? <><Loader2 className="w-4 h-4 animate-spin"/> Auditing Tariff...</> : "Start Municipal Scan"}
                    </button>
                  </div>
                )}
              </div>
            ) : (
              <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                <div className={`lg:col-span-8 border rounded-[2rem] p-8 shadow-2xl ${isDarkMode ? 'bg-slate-900/40 border-white/5' : 'bg-white border-slate-200'}`}>
                   <div className="flex justify-between items-center mb-8">
                      <h3 className={`text-sm font-black uppercase tracking-widest flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>
                        <PieChart className="w-4 h-4 text-lime-500" /> Audited Components
                      </h3>
                      <span className={`text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full ${isDarkMode ? 'text-slate-500 bg-white/5' : 'text-slate-400 bg-slate-100'}`}>{auditResults.billing_month} Cycle</span>
                   </div>
                   <div className="space-y-6">
                      {auditResults.cost_breakdown.map((item, i) => {
                        const pct = (item.amount / auditResults.total_amount_due) * 100;
                        return (
                          <div key={i}>
                            <div className="flex justify-between text-[11px] font-black mb-2 uppercase">
                              <span className="text-slate-400">{item.category}</span>
                              <span className={isDarkMode ? 'text-white' : 'text-slate-900'}>{CURRENCY_SYMBOL}{item.amount.toLocaleString()} ({pct.toFixed(0)}%)</span>
                            </div>
                            <div className={`h-2 rounded-full overflow-hidden ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>
                              <div className="h-full bg-lime-500" style={{ width: `${pct}%` }}></div>
                            </div>
                          </div>
                        )
                      })}
                   </div>
                   <div className={`mt-10 p-6 rounded-2xl border ${isDarkMode ? 'bg-lime-500/5 border-lime-500/10' : 'bg-lime-50/50 border-lime-100'}`}>
                      <div className="flex items-start gap-4">
                        <Calculator className="w-5 h-5 text-lime-500 shrink-0 mt-1" />
                        <div>
                          <h4 className={`text-[11px] font-black uppercase tracking-widest mb-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Audited Tariff</h4>
                          <p className="text-[11px] text-slate-500 leading-relaxed font-medium">
                            Derived rate: <span className="text-lime-500 font-black">{CURRENCY_SYMBOL}{(auditResults.total_amount_due / auditResults.total_consumption).toFixed(2)} / kWh</span> (incl. VAT). 
                            Solar generation will directly reduce the variable Energy Charges and associated VAT outflows.
                          </p>
                        </div>
                      </div>
                   </div>
                </div>
                <div className="lg:col-span-4 space-y-4">
                  <div className="bg-lime-500 rounded-[1.5rem] p-6 text-white shadow-xl shadow-lime-500/10">
                    <p className="text-[10px] font-black uppercase opacity-60 mb-1">Baseline Rate</p>
                    <h4 className="text-4xl font-black tracking-tighter mb-4">{CURRENCY_SYMBOL}{(auditResults.total_amount_due / auditResults.total_consumption).toFixed(2)}</h4>
                    <p className="text-[10px] font-bold leading-tight uppercase opacity-80">Every unit generated by solar avoids this municipal cost while providing long-term protection against inflation.</p>
                  </div>
                  <button onClick={() => setPhase(2)} className={`w-full py-5 font-black uppercase text-[11px] tracking-widest rounded-[1.5rem] flex items-center justify-center gap-2 transition-all ${isDarkMode ? 'bg-white text-black hover:bg-lime-500 hover:text-white' : 'bg-slate-900 text-white hover:bg-lime-500 shadow-lg'}`}>
                    Analyze Impact <ArrowRight className="w-4 h-4" />
                  </button>
                  <button onClick={() => setAuditResults(null)} className="w-full text-[10px] text-slate-500 font-bold uppercase py-2">Reset Audit</button>
                </div>
              </div>
            )}
          </div>
        )}

        {/* Phase 2 */}
        {phase === 2 && auditResults && (
          <div className="space-y-8 animate-in slide-in-from-right-10 duration-500 pb-20">
            <div className="text-center">
              <h2 className={`text-2xl font-black mb-2 uppercase tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Phase 2: Long-Term Economic Audit</h2>
              <p className="text-slate-500 text-xs font-medium">Calibrated with 6.5% compounded escalation and conservative P90 hardware yields.</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className={`border rounded-3xl p-6 flex flex-col justify-between shadow-xl ${isDarkMode ? 'bg-slate-900 border-white/5' : 'bg-white border-slate-200'}`}>
                    <div className="flex items-center gap-4 mb-4">
                      <div className="p-3 bg-blue-500/10 rounded-2xl border border-blue-500/20">
                        <Activity className="w-6 h-6 text-blue-500" />
                      </div>
                      <div>
                        <h5 className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Annual Demand (P90)</h5>
                        <p className={`text-xl font-black tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{Math.round(comparison.annualConsumption).toLocaleString()} <span className="text-sm font-medium text-slate-500">kWh</span></p>
                      </div>
                    </div>
                    <button onClick={() => { setActiveModal('seasonality'); setIsBreakdownOpen(true); }} className={`w-full py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all ${isDarkMode ? 'bg-slate-800 hover:bg-slate-700 text-white' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}`}>
                       <Calendar className="w-3 h-3 text-blue-500" /> View Demand Trends
                    </button>
                </div>
                <div className={`border rounded-3xl p-6 flex flex-col justify-between shadow-xl ${isDarkMode ? 'bg-slate-900 border-white/5' : 'bg-white border-slate-200'}`}>
                    <div className="flex items-center gap-4 mb-4">
                      <div className="p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20">
                        <Coins className="w-6 h-6 text-emerald-500" />
                      </div>
                      <div>
                        <h5 className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Baseline Liability</h5>
                        <p className={`text-xl font-black tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{CURRENCY_SYMBOL}{Math.round(comparison.annualLiability).toLocaleString()} <span className="text-sm font-medium text-slate-500">/ Yr</span></p>
                      </div>
                    </div>
                    <button onClick={() => { setActiveModal('financials'); setIsBreakdownOpen(true); }} className={`w-full py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all ${isDarkMode ? 'bg-slate-800 hover:bg-slate-700 text-white' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}`}>
                       <TrendingUp className="w-3 h-3 text-emerald-500" /> Show 25-Yr Calculation
                    </button>
                </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
              {/* System 1 */}
              <div className={`border rounded-[2.5rem] overflow-hidden shadow-2xl transition-all relative ${isDarkMode ? 'bg-slate-900 border-white/5 hover:border-lime-500/20' : 'bg-white border-slate-200 hover:border-lime-500/30'}`}>
                <div className="p-8">
                  <div className="flex justify-between items-start mb-8">
                    <div>
                      <h4 className={`text-lg font-black uppercase tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>65kWp Solar Suite</h4>
                      <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Single 50kW Inverter + 60kWh BESS</p>
                    </div>
                    <div className="bg-lime-500/10 text-lime-500 p-3 rounded-2xl"><Battery className="w-6 h-6"/></div>
                  </div>
                  
                  <div className="space-y-6">
                    <div>
                      <label className="text-[10px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Initial CAPEX Estimate</label>
                      <div className="relative">
                        <span className="absolute left-4 top-1/2 -translate-y-1/2 text-lime-500 font-black text-xs">{CURRENCY_SYMBOL}</span>
                        <input 
                          type="number" 
                          value={supplierCostA} 
                          onChange={(e) => setSupplierCostA(parseInt(e.target.value) || 0)}
                          className={`w-full rounded-2xl py-4 pl-10 pr-4 text-xl font-black tracking-tighter focus:border-lime-500 outline-none transition-all ${isDarkMode ? 'bg-black/50 border-white/5 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`}
                        />
                      </div>
                    </div>

                    <div className={`grid grid-cols-2 gap-4 py-4 border-y ${isDarkMode ? 'border-white/5' : 'border-slate-100'}`}>
                      <div>
                        <div className="flex items-center gap-1.5 mb-1">
                          <p className="text-[9px] font-black text-slate-500 uppercase tracking-widest">Yield (P90)</p>
                          <div className="group/tip relative">
                            <Info className="w-3 h-3 text-slate-600 cursor-help"/>
                            <div className={`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 text-[8px] rounded-lg opacity-0 group-hover/tip:opacity-100 transition-opacity pointer-events-none z-10 font-bold leading-relaxed ${isDarkMode ? 'bg-slate-800 text-white' : 'bg-slate-900 text-white'}`}>
                              P90 (Probability of Exceedance 90%) means a 90% confidence that the system will produce at least this much energy.
                            </div>
                          </div>
                        </div>
                        <p className={`text-md font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{comparison.systemA.annualProd.toLocaleString()} <span className="text-[9px] text-slate-500 font-medium">kWh</span></p>
                      </div>
                      <div className="text-right">
                        <p className="text-[9px] font-black text-slate-500 uppercase mb-1">Demand Coverage</p>
                        <p className="text-md font-black text-lime-500">{comparison.systemA.coveragePct.toFixed(1)}%</p>
                      </div>
                    </div>

                    <div className={`p-5 rounded-3xl relative overflow-hidden group border ${isDarkMode ? 'bg-emerald-500/5 border-emerald-500/10' : 'bg-emerald-50/50 border-emerald-100'}`}>
                      <TrendingUp className="absolute -right-2 -bottom-2 w-16 h-16 text-emerald-500 opacity-5 group-hover:opacity-10 transition-opacity" />
                      <div className="flex justify-between items-center mb-1">
                        <span className="text-[10px] font-black text-emerald-500 uppercase tracking-widest">Year 1 Saving</span>
                        <span className={`text-lg font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{CURRENCY_SYMBOL}{Math.round(comparison.systemA.annualSaving).toLocaleString()}</span>
                      </div>
                      <div className={`flex justify-between items-center pt-2 border-t ${isDarkMode ? 'border-emerald-500/20' : 'border-emerald-200'}`}>
                        <div className="flex items-center gap-1.5">
                          <span className="text-[10px] font-black text-emerald-600 uppercase tracking-widest">25-Yr Lifetime Savings</span>
                        </div>
                        <span className={`text-lg font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{CURRENCY_SYMBOL}{Math.round(comparison.systemA.twentyFiveYearNetSaving).toLocaleString()}</span>
                      </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4 text-center">
                      <div className={`p-3 rounded-2xl border ${isDarkMode ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100'}`}>
                        <div className="flex items-center justify-center gap-1.5 mb-1">
                          <p className="text-[9px] font-black text-slate-500 uppercase tracking-widest">LCOE</p>
                          <div className="group/tip relative">
                            <Info className="w-3 h-3 text-slate-600 cursor-help"/>
                            <div className={`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 text-[8px] rounded-lg opacity-0 group-hover/tip:opacity-100 transition-opacity pointer-events-none z-10 font-bold leading-relaxed ${isDarkMode ? 'bg-slate-800 text-white' : 'bg-slate-900 text-white'}`}>
                              Levelized Cost of Energy: Your fixed per-unit cost over 25 years.
                            </div>
                          </div>
                        </div>
                        <p className="text-md font-black text-lime-500">{CURRENCY_SYMBOL}{comparison.systemA.lcoe.toFixed(2)}</p>
                      </div>
                      <div className={`p-3 rounded-2xl border ${isDarkMode ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100'}`}>
                        <p className="text-[9px] font-black text-slate-500 uppercase mb-1">Payback</p>
                        <p className={`text-md font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{comparison.systemA.payback.toFixed(1)} Yrs</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* System 2 */}
              <div className={`border-2 rounded-[2.5rem] overflow-hidden shadow-2xl relative transition-all ${isDarkMode ? 'bg-slate-900 border-lime-500/20' : 'bg-white border-lime-500/30'}`}>
                <div className="absolute top-4 right-8 bg-lime-500 text-white px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest">Recommended Scale</div>
                <div className="p-8">
                  <div className="flex justify-between items-start mb-8">
                    <div>
                      <h4 className={`text-lg font-black uppercase tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>130kWp Hybrid Suite</h4>
                      <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Dual 50kW Inverters + 120kWh BESS</p>
                    </div>
                    <div className="bg-lime-500/10 text-lime-500 p-3 rounded-2xl"><TrendingUp className="w-6 h-6"/></div>
                  </div>

                  <div className="space-y-6">
                    <div>
                      <label className="text-[10px] font-black uppercase text-slate-500 mb-2 block tracking-widest">Initial CAPEX Estimate</label>
                      <div className="relative">
                        <span className="absolute left-4 top-1/2 -translate-y-1/2 text-lime-500 font-black text-xs">{CURRENCY_SYMBOL}</span>
                        <input 
                          type="number" 
                          value={supplierCostB} 
                          onChange={(e) => setSupplierCostB(parseInt(e.target.value) || 0)}
                          className={`w-full rounded-2xl py-4 pl-10 pr-4 text-xl font-black tracking-tighter focus:border-lime-500 outline-none transition-all ${isDarkMode ? 'bg-black/50 border-white/5 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`}
                        />
                      </div>
                    </div>

                    <div className={`grid grid-cols-2 gap-4 py-4 border-y ${isDarkMode ? 'border-white/5' : 'border-slate-100'}`}>
                      <div>
                        <div className="flex items-center gap-1.5 mb-1">
                          <p className="text-[9px] font-black text-slate-500 uppercase tracking-widest">Yield (P90)</p>
                          <div className="group/tip relative">
                            <Info className="w-3 h-3 text-slate-600 cursor-help"/>
                            <div className={`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 text-[8px] rounded-lg opacity-0 group-hover/tip:opacity-100 transition-opacity pointer-events-none z-10 font-bold leading-relaxed text-left ${isDarkMode ? 'bg-slate-800 text-white' : 'bg-slate-900 text-white'}`}>
                               High-confidence generation based on 25-year solar irradiance averages.
                            </div>
                          </div>
                        </div>
                        <p className={`text-md font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{comparison.systemB.annualProd.toLocaleString()} <span className="text-[9px] text-slate-500 font-medium">kWh</span></p>
                      </div>
                      <div className="text-right">
                        <p className="text-[9px] font-black text-slate-500 uppercase mb-1">Demand Coverage</p>
                        <p className="text-md font-black text-lime-500">{comparison.systemB.coveragePct.toFixed(1)}%</p>
                      </div>
                    </div>

                    <div className={`p-5 rounded-3xl relative overflow-hidden group border ${isDarkMode ? 'bg-emerald-500/10 border-emerald-500/20' : 'bg-emerald-50/50 border-emerald-100'}`}>
                      <TrendingUp className="absolute -right-2 -bottom-2 w-16 h-16 text-emerald-500 opacity-5 group-hover:opacity-10 transition-opacity" />
                      <div className="flex justify-between items-center mb-1">
                        <span className="text-[10px] font-black text-emerald-500 uppercase tracking-widest">Year 1 Saving</span>
                        <span className={`text-lg font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{CURRENCY_SYMBOL}{Math.round(comparison.systemB.annualSaving).toLocaleString()}</span>
                      </div>
                      <div className={`flex justify-between items-center pt-2 border-t ${isDarkMode ? 'border-emerald-500/20' : 'border-emerald-200'}`}>
                         <div className="flex items-center gap-1.5">
                          <span className="text-[10px] font-black text-emerald-600 uppercase tracking-widest">25-Yr Lifetime Savings</span>
                        </div>
                        <span className={`text-lg font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{CURRENCY_SYMBOL}{Math.round(comparison.systemB.twentyFiveYearNetSaving).toLocaleString()}</span>
                      </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4 text-center">
                      <div className={`p-3 rounded-2xl border ${isDarkMode ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100'}`}>
                        <div className="flex items-center justify-center gap-1.5 mb-1">
                          <p className="text-[9px] font-black text-slate-500 uppercase tracking-widest">LCOE</p>
                          <div className="group/tip relative">
                            <Info className="w-3 h-3 text-slate-600 cursor-help"/>
                            <div className={`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 text-[8px] rounded-lg opacity-0 group-hover/tip:opacity-100 transition-opacity pointer-events-none z-10 font-bold leading-relaxed ${isDarkMode ? 'bg-slate-800 text-white' : 'bg-slate-900 text-white'}`}>
                               The fixed cost of electricity 'locked-in' for the school's future.
                            </div>
                          </div>
                        </div>
                        <p className="text-md font-black text-lime-500">{CURRENCY_SYMBOL}{comparison.systemB.lcoe.toFixed(2)}</p>
                      </div>
                      <div className={`p-3 rounded-2xl border ${isDarkMode ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100'}`}>
                        <p className="text-[9px] font-black text-slate-500 uppercase mb-1">Payback</p>
                        <p className={`text-md font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{comparison.systemB.payback.toFixed(1)} Yrs</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button onClick={() => setPhase(3)} className={`w-full py-5 font-black uppercase text-xs tracking-widest rounded-3xl shadow-2xl transition-all flex items-center justify-center gap-4 ${isDarkMode ? 'bg-white text-black hover:bg-lime-500 hover:text-white' : 'bg-slate-900 text-white hover:bg-lime-500 shadow-xl'}`}>
               Phase 3: Tender & Sponsorship Match <ArrowRight className="w-5 h-5" />
            </button>
          </div>
        )}

        {/* Phase 3 */}
        {phase === 3 && (
          <div className="space-y-12 animate-in slide-in-from-bottom-10 duration-700 pb-20">
            <div className={`border rounded-[2rem] p-12 shadow-2xl transition-all ${isDarkMode ? 'bg-slate-900/40 border-white/5' : 'bg-white border-slate-200'}`}>
              <div className="text-center mb-10">
                <h2 className={`text-3xl font-black mb-2 uppercase tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Phase 3: Partnership Initiation</h2>
                <p className="text-slate-500 text-xs font-medium">Matching audited school requirements with pre-vetted EPC sponsors for project funding.</p>
              </div>
              
              <div className={`p-8 rounded-3xl mb-12 border flex flex-col md:flex-row gap-6 items-center ${isDarkMode ? 'bg-lime-500/5 border-lime-500/10' : 'bg-lime-50 border-lime-100'}`}>
                 <div className="p-4 bg-lime-500 text-white rounded-2xl"><HandCoins className="w-8 h-8" /></div>
                 <div>
                    <h4 className={`text-sm font-black uppercase mb-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>The Sponsorship Advantage</h4>
                    <p className="text-xs text-slate-500 font-medium leading-relaxed">By connecting with our partner network, schools can attract EPC sponsors who provide flexible financing, grant matching, or full CSR funding in exchange for the long-term educational and environmental impact credits.</p>
                 </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div className="space-y-4">
                  <div className="relative"><User className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500" /><input placeholder="Contact Person" className={`w-full rounded-xl py-3 pl-12 text-sm outline-none transition-all ${isDarkMode ? 'bg-slate-950 border border-white/10 text-white focus:border-lime-500' : 'bg-slate-50 border border-slate-200 text-slate-900 focus:border-lime-500'}`} /></div>
                  <div className="relative"><Building2 className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500" /><input placeholder="School Name" className={`w-full rounded-xl py-3 pl-12 text-sm outline-none transition-all ${isDarkMode ? 'bg-slate-950 border border-white/10 text-white focus:border-lime-500' : 'bg-slate-50 border border-slate-200 text-slate-900 focus:border-lime-500'}`} /></div>
                </div>
                <div className="space-y-4">
                  <div className="relative"><Mail className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500" /><input placeholder="Email Address" className={`w-full rounded-xl py-3 pl-12 text-sm outline-none transition-all ${isDarkMode ? 'bg-slate-950 border border-white/10 text-white focus:border-lime-500' : 'bg-slate-50 border border-slate-200 text-slate-900 focus:border-lime-500'}`} /></div>
                  <div className="relative"><Phone className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500" /><input placeholder="Phone Number" className={`w-full rounded-xl py-3 pl-12 text-sm outline-none transition-all ${isDarkMode ? 'bg-slate-950 border border-white/10 text-white focus:border-lime-500' : 'bg-slate-50 border border-slate-200 text-slate-900 focus:border-lime-500'}`} /></div>
                </div>
              </div>
              <button onClick={() => alert("Interest Sent to EPC Partners")} className="w-full py-5 bg-gradient-to-r from-lime-500 to-emerald-600 text-white rounded-3xl font-black text-xs uppercase tracking-widest shadow-2xl shadow-lime-500/20 flex items-center justify-center gap-4 active:scale-95 transition-transform">
                SEND TENDER INTEREST <ArrowRight className="w-5 h-5" />
              </button>
              <button onClick={() => setPhase(2)} className="w-full text-center text-slate-600 font-black uppercase text-[10px] tracking-widest mt-6 hover:text-slate-400">Back to Economic Analysis</button>
            </div>

            {/* Rolling Carousel */}
            <div className={`border rounded-3xl py-8 overflow-hidden relative transition-all ${isDarkMode ? 'bg-slate-900/40 border-white/5' : 'bg-white border-slate-200'}`}>
              <div className="text-center mb-6 px-4">
                <h3 className="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-1">Approved Sponsorship Network</h3>
                <p className="text-[9px] text-slate-600 uppercase font-bold">Vetted EPC partners active in your specific region</p>
              </div>
              
              <div className="relative flex overflow-x-hidden">
                <div className="animate-scroll">
                  {[...SPONSORS, ...SPONSORS].map((sponsor, idx) => (
                    <div key={idx} className={`flex-shrink-0 w-[250px] mx-4 flex items-center gap-3 px-6 py-4 border rounded-2xl group transition-all ${isDarkMode ? 'bg-slate-950/80 border-white/5 hover:border-lime-500/30' : 'bg-slate-50 border-slate-100 hover:border-lime-500/30 hover:bg-white shadow-sm'}`}>
                      <div className={`w-8 h-8 rounded-lg flex items-center justify-center transition-colors ${isDarkMode ? 'bg-white/5 group-hover:bg-lime-500/10' : 'bg-white group-hover:bg-lime-50'}`}>
                        <Globe className={`w-4 h-4 text-slate-400 group-hover:text-lime-500 transition-colors`} />
                      </div>
                      <span className={`text-[10px] font-black uppercase tracking-wider transition-colors ${isDarkMode ? 'text-slate-400 group-hover:text-white' : 'text-slate-500 group-hover:text-slate-900'}`}>{sponsor}</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className={`absolute inset-y-0 left-0 w-24 pointer-events-none z-10 transition-all ${isDarkMode ? 'bg-gradient-to-r from-[#020617] to-transparent' : 'bg-gradient-to-r from-slate-50 to-transparent'}`}></div>
              <div className={`absolute inset-y-0 right-0 w-24 pointer-events-none z-10 transition-all ${isDarkMode ? 'bg-gradient-to-l from-[#020617] to-transparent' : 'bg-gradient-to-l from-slate-50 to-transparent'}`}></div>
            </div>
          </div>
        )}
      </main>

      {/* Main Breakdown Modal */}
      {isBreakdownOpen && comparison && (
        <div className="fixed inset-0 z-[100] bg-black/90 backdrop-blur-md flex items-center justify-center p-4">
          <div className={`rounded-[2.5rem] w-full max-w-2xl overflow-hidden shadow-2xl animate-in zoom-in-95 duration-200 border ${isDarkMode ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}`}>
             
             <div className={`p-8 border-b flex justify-between items-center ${isDarkMode ? 'border-white/5 bg-slate-950/50' : 'border-slate-100 bg-slate-50'}`}>
                <div>
                   <h3 className={`text-lg font-black uppercase tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>
                     {activeModal === 'seasonality' ? 'Consumption Profiles' : '25-Year Saving Logic'}
                   </h3>
                   <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest">
                     {activeModal === 'seasonality' ? 'Weighted Seasonal Distribution for Schools' : 'Detailed Compounded Financial Audit'}
                   </p>
                </div>
                <button onClick={() => setIsBreakdownOpen(false)} className={`p-2 rounded-xl transition-colors ${isDarkMode ? 'bg-white/5 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-500 hover:text-slate-900'}`}><X className="w-5 h-5"/></button>
             </div>

             <div className="p-8 max-h-[65vh] overflow-y-auto custom-scrollbar">
                
                {activeModal === 'seasonality' ? (
                  <table className="w-full text-left text-[11px]">
                     <thead>
                        <tr className="text-slate-500 font-black uppercase tracking-widest border-b border-white/5">
                           <th className="pb-4 font-black">Month</th>
                           <th className="pb-4 font-black">Consumption</th>
                           <th className="pb-4 text-right font-black">Municipal Cost</th>
                        </tr>
                     </thead>
                     <tbody className="divide-y divide-white/5">
                        {comparison.annualProjection.map((row, i) => (
                          <tr key={i} className={`group transition-colors ${isDarkMode ? 'hover:bg-white/5' : 'hover:bg-slate-50'}`}>
                             <td className={`py-3.5 font-bold ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>
                               {row.month} 
                               {row.month === "March" && <span className="ml-2 text-[8px] bg-red-500/20 text-red-500 px-1.5 py-0.5 rounded uppercase font-black">Academic Peak</span>}
                               {["January", "December"].includes(row.month) && <span className="ml-2 text-[8px] px-1.5 py-0.5 rounded uppercase font-black bg-slate-200 text-slate-500">Recess</span>}
                             </td>
                             <td className="py-3.5 text-slate-500">{Math.round(row.consumption).toLocaleString()} kWh</td>
                             <td className={`py-3.5 text-right font-black ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{CURRENCY_SYMBOL}{Math.round(row.cost).toLocaleString()}</td>
                          </tr>
                        ))}
                     </tbody>
                  </table>
                ) : (
                  <div className="space-y-10">
                    <div>
                      <h4 className={`text-[11px] font-black uppercase mb-4 ${isDarkMode ? 'text-lime-500' : 'text-emerald-600'}`}>Compounded Saving Schedule (Year 1-25)</h4>
                      <table className="w-full text-left text-[10px]">
                         <thead>
                            <tr className="text-slate-500 font-black uppercase border-b border-white/5">
                               <th className="pb-2">Year</th>
                               <th className="pb-2">Municipal Rate</th>
                               <th className="pb-2">Annual Savings</th>
                               <th className="pb-2 text-right">Cumulative</th>
                            </tr>
                         </thead>
                         <tbody className="divide-y divide-white/5">
                            {comparison.systemB.yearByYear.filter(y => y.year === 1 || y.year % 5 === 0).map((y, i) => (
                              <tr key={i} className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>
                                 <td className="py-2.5 font-bold">Year {y.year}</td>
                                 <td className="py-2.5">{CURRENCY_SYMBOL}{y.rate.toFixed(2)}/kWh</td>
                                 <td className="py-2.5">{CURRENCY_SYMBOL}{Math.round(y.savings).toLocaleString()}</td>
                                 <td className="py-2.5 text-right font-black text-lime-500">{CURRENCY_SYMBOL}{Math.round(y.cumulative).toLocaleString()}</td>
                              </tr>
                            ))}
                         </tbody>
                      </table>
                    </div>

                    <div className="grid gap-4">
                      <div className={`p-4 rounded-2xl border ${isDarkMode ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100'}`}>
                        <div className="flex items-center gap-3 mb-2">
                          <TrendingUp className="w-4 h-4 text-lime-500" />
                          <h4 className={`text-[10px] font-black uppercase tracking-widest ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Escalation & Degradation</h4>
                        </div>
                        <p className="text-[10px] text-slate-500 leading-relaxed">
                          We assume a **6.5% annual compounded increase** in municipal rates. Conversely, we model a **0.7% annual yield degradation** for hardware. Even with reduced yield, the rising cost of utility power makes solar increasingly valuable over time.
                        </p>
                      </div>

                      <div className={`p-4 rounded-2xl border ${isDarkMode ? 'bg-white/5 border-white/5' : 'bg-slate-50 border-slate-100'}`}>
                        <div className="flex items-center gap-3 mb-2">
                          <Calculator className="w-4 h-4 text-blue-500" />
                          <h4 className={`text-[10px] font-black uppercase tracking-widest ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>P90 Yield Logic</h4>
                        </div>
                        <p className="text-[10px] text-slate-500 leading-relaxed">
                          **P90** represents a high-certainty forecast (90% confidence). We deliberately model for poor weather cycles to ensure the school's financial resilience, rather than over-promising based on ideal P50 conditions.
                        </p>
                      </div>
                    </div>
                  </div>
                )}
             </div>

             <div className={`p-8 border-t flex gap-4 ${isDarkMode ? 'bg-slate-950/50 border-white/5' : 'bg-slate-50 border-slate-100'}`}>
                <div className="p-3 bg-blue-500/10 rounded-xl border border-blue-500/20 shrink-0"><Info className="w-5 h-5 text-blue-500" /></div>
                <p className="text-[10px] text-slate-500 leading-relaxed font-medium">
                   This audit utilizes audited tariff rates and conservative meteorological yields. Final EPC tender interest will confirm specific sponsor funding availability.
                </p>
             </div>
          </div>
        </div>
      )}

      {/* Config Overlay */}
      {isConfigOpen && (
        <div className="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
          <div className={`border p-8 rounded-[2rem] max-w-sm w-full shadow-2xl transition-all ${isDarkMode ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-200'}`}>
            <h3 className={`text-sm font-black uppercase tracking-widest mb-6 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Configuration</h3>
            <div className="mb-6">
              <label className="text-[10px] font-black text-slate-500 uppercase block mb-2">Gemini API Key</label>
              <input type="password" value={apiKey} onChange={(e) => setApiKey(e.target.value)} className={`w-full border rounded-xl py-3 px-4 text-xs outline-none focus:border-lime-500 transition-all ${isDarkMode ? 'bg-black border-white/5 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`} />
            </div>
            <button onClick={() => { localStorage.setItem('tariff_verify_key', apiKey); setIsConfigOpen(false); }} className="w-full py-3 bg-lime-500 text-white font-black uppercase text-[10px] tracking-widest rounded-xl shadow-lg hover:bg-lime-600 transition-colors">Save Key</button>
            <button onClick={() => setIsConfigOpen(false)} className="w-full text-center text-slate-500 font-bold uppercase text-[9px] mt-4">Close</button>
          </div>
        </div>
      )}
    </div>
  );
};

export default App;